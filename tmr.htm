 <!DOCTYPE HTML lang="en">
 <html>
 
 <head>
 	<title>Work/Break Tmr</title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 	<meta name="description" content="tmr" />
 	<meta name="viewport" content="width=device-width, initial-scale=1"/>
 	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
 	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
 	<link rel="icon" href="favicon.ico" type="image/x-icon" />
 	<style type="text/css">
 		body { font-family: 'Calibri', 'Noto Sans Display', 'Noto Sans', sans-serif; }
 		h1 {margin: .5ex .25ex .25ex 0ex;}
 		input.is-invalid { background-color: #FFEEEE; }
 		input.is-valid { background-color: #EEFFEE; }
		input#remainDuration { font-weight:bold; }
		
 		label { min-width: 140pt; display:inline-block; text-align:right; margin:0px 2px; padding:0;}
		fieldset #rdWB { margin-left: 145pt; }
		label[for=remainDuration] { font-weight:bold; }
 		label.nowidth, label.tlog { min-width:0; text-align:left; }
 		label.radio, label.checkbox { min-width: 17ex; display:inline-block; text-align:left; }
 		label.log { display:inline-block; text-align:left; }
 		fieldset { border: 1px solid #E0E0E0; display:inline-block; }
 		.btnBig {min-width: 24ex; min-height: 5em;}
		.btnBigNarrow {min-width: 18ex; min-height: 5em;}
		.btnMedium {min-width: 24ex; min-height: 2.5em;}
		.medBtnGrp { border:0; padding:0; margin:0; display:inline-block; max-width: 24ex; vertical-align:bottom; }
 		
 		#frmTmr { border: 10px solid transparent; padding: 4px; }
 		
 		#frmTmr.notify {
 			border: 10px solid #FFCFB9;
 			animation:blinkBorder 1.2s infinite;
 		}
 		
 		#frmTmr.notifyoverdue {
 			border: 10px solid #FFCFB9;
 			animation:blinkBorderLight 2.4s 15;
 		}
 		
 		@keyframes blinkBorder{
			  0%{	border-color: #FFCFB9;    }
			 25%{	border-color: #FFA346; }
			 49%{	border-color: #FFCFB9;    }
			 60%{	border-color: transparent; }
			 99%{	border-color:transparent;  }
			100%{	border-color: #FFCFB9;    }
		}
		
		@keyframes blinkBorderLight{
			  0%{	border-color: #FFCFB9;    }
			 49%{	border-color: #FFA346; }
			 99%{	border-color: #FFCFB9;    }
			100%{	border-color: #FFCFB9;    }
		}
 		
 		#frmTmr.init { 
 			background-color: #F0F0F0; 
 		}
 		#frmTmr.paused { 
 			background-color: #E0E0F5; 
 		}
 		#frmTmr.working {
 			background-color: #F0F5F0;	
 		}
 		#frmTmr.breakrequired {
 			background-color: #FED1DD;
 		}
 		#frmTmr.onbreak {
 			background-color: #BADEB8;
 		}
 		#frmTmr.breakover {
 			background-color: #FFFFD2;
 		}
 		
 		
 		
 	</style>
 	<!--script src="jquery-3.5.1.slim.js" type="text/javascript"></script-->
 	<script type="text/javascript">
 		var tmrInt = null;
 		var tmrEvt = null;
 		
 		var startTime = null; // only valid when running, time when work/break started
 		var evtTime = null; // only valid when running, time when work/break ends/ended
 		var remDuration = 0; // only valid when paused: remaining duration
 		var elaDuration = 0; // only valid when paused: elapsed duration
 		var workSum = 0;
 		var breakSum = 0;
 		var workSessionsStartedNum = 0;
 		var workSessionsFinishedNum = 0;
 		var breakSessionsStartedNum = 0;
 		var breakSessionsFinishedNum = 0;
		var longBreakSessionsStartedNum = 0;
 		var longBreakSessionsFinishedNum = 0;
		
		var workSessionsStartedSinceLongBreakNum = 0;
 		var workSessionsFinishedSinceLongBreakNum = 0;
 		
 		var wrkDur = 0;
 		var brkDur = 0;
 		
 		var isNotifying = 0;
 		var Notif = null;
 		var notify = null;
		
		var TmrGlobalStateList = {};
		var TmrVersion = "v0.9.2";
 		
 		const tmrstate = {
		    INIT: 'init',
		    WORKING: 'working',
		    BREAKREQUIRED: 'breakrequired',
			LONGBREAKREQUIRED: 'longbreakrequired',
		    ONBREAK: 'onbreak',
			ONLONGBREAK: 'onlongbreak',
		    BREAKOVER: 'breakover',
			LONGBREAKOVER: 'longbreakover'
		}
		
		const breaktype = {
			UNDEFINEDBREAK: 'undefinedbreak',
		    SHORTBREAK: 'shortbreak',
			LONGBREAK: 'longbreak'
		}
		
		var isRunning = false;
		
		let state = tmrstate.INIT;

 		
		function clearLog() {
			document.getElementById("tlog").value = "";
		}
		
 		function alertl(txt, lvl) {
			if ((lvl == undefined) || (lvl == null)) {
			    lvl = 2;
			}
			var printlvl = ((document.getElementById("cbDebugLog").checked)? 4 : 1);
			
			if (lvl > printlvl) {
			    // too verbose for log setting
			    console.log("debug output suppressed on log textarea: "+txt);
			    return;
			}
			dto = new Date();
			dt = fmtDateTime(dto)+'.';//dto.getHours()+":"+dto.getMinutes()+":"+dto.getSeconds()+" "
			//no = "$"+lognum++ + " "
			tlog = document.getElementById("tlog");
			tlog.value = dt + txt +"\r\n" + tlog.value;
		}
		
		function isEmptyObj(obj) {
			for(var key in obj) {
				if(obj.hasOwnProperty(key))
					return false;
			}
			return true;
		}
 		
 		function clearSessionCounts() {
 			workSessionsStartedNum = 0;
 			workSessionsFinishedNum = 0;
 			breakSessionsStartedNum = 0;
 			breakSessionsFinishedNum = 0;
			longBreakSessionsStartedNum = 0;
 			longBreakSessionsFinishedNum = 0;
			
			workSessionsStartedSinceLongBreakNum = 0;
			workSessionsFinishedSinceLongBreakNum = 0;
			
			renderTmrState();
 		}
		
		function clearSessionTimeSums() {
			workSum = 0;
			breakSum = 0;
 		
			wrkDur = 0;
			brkDur = 0;
			
			renderTmrState();
		}
 		
 		function onTmrInt() {
 			tickTmr();
 		}
 		
 		function onTmrEvt() {
 			tickTmr();
 		}
 		
 		
 		function state2str(st) {
 			switch (st) {
 				case tmrstate.INIT:
 						return "Initialized."
 					break;
 				case tmrstate.WORKING:
						return "You should be working."
	 				break;
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
						if (isLongBreak()) {
							return "You should take a LONG break for "+ duration2txt(determineBreakDuration())+'.'
						} else {
							return "You should take a break for "+ duration2txt(determineBreakDuration())+'.'
						}
	 				break;
 				case tmrstate.ONBREAK:
				case tmrstate.ONLONGBREAK:
						if (isLongBreak()) {
							return "You should be taking a long break."
						} else {
							return "You should be taking a break."
						}
	 				break;
 				case tmrstate.BREAKOVER:
				case tmrstate.LONGBREAKOVER:
 						return "You should finish your break (work for "+ duration2txt(determineWorkDuration())+').'
	 				break;
 			}
 			return "";
 		}
		
		function state2strshort(st) {
 			switch (st) {
 				case tmrstate.INIT:
 						return "Initialized."
 					break;
 				case tmrstate.WORKING:
						return "Work session."
	 				break;
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
						if (isLongBreak()) {
							return "Take a LONG break ("+ duration2txt(determineBreakDuration())+')'
						} else {
							return "Take a break ("+ duration2txt(determineBreakDuration())+')'
						}
	 				break;
					
 				case tmrstate.ONBREAK:
				case tmrstate.ONLONGBREAK:
						if (isLongBreak()) {
							return "Long break."
						} else {
							return "Break."
						}
	 				break;
 				case tmrstate.BREAKOVER:
				case tmrstate.LONGBREAKOVER:
 						return "Finish your break (work for "+ duration2txt(determineWorkDuration())+').'
	 				break;
 			}
 			return "";
 		}
 		
 		function state2strlong(st) {
 			str = "Hi there. "
 			switch (st) {
 				case tmrstate.INIT:
 						str += "Tmr initialized."
 					break;
 				case tmrstate.WORKING:
						str +=  "You should be working."
	 				break;
 				case tmrstate.BREAKREQUIRED:
						str +=  "You should now take a break for "+ duration2txt(determineBreakDuration())+' (h:m:s).'
	 				break;
				case tmrstate.LONGBREAKREQUIRED:
 						str +=  "You should now take a long break for "+ duration2txt(determineBreakDuration())+' (h:m:s).'
	 				break;
 				case tmrstate.ONBREAK:
						str +=  "You should be enjoying your break right now."
					break;
				case tmrstate.ONLONGBREAK:
 						str +=  "You should be enjoying your long break right now."
	 				break;
 				case tmrstate.BREAKOVER:
						str +=  "You should finish your break and continue working for "+ duration2txt(determineWorkDuration())+' (h:m:s).'
					break;
				case tmrstate.LONGBREAKOVER:
 						str +=  "You should finish your long break and continue working for "+ duration2txt(determineWorkDuration())+' (h:m:s).'
	 				break;
 			}
 			return str;
 		}
 		
 		function startTmr() { // also: resume
 			
 			if (!validateInput()) {
 				return;
 			}
 			
 			if (isRunning) {
 				return;
 			}
 			
 			
 			wdstr = document.getElementById('workDuration').value;
 			wd = txt2duration(wdstr)
 			
 			bdstr = document.getElementById('breakDuration').value;
 			bd = txt2duration(bdstr)
 			
 			ndstr = document.getElementById('notifyDuration').value;
 			nd = txt2duration(ndstr)
 			
 			remdstr = document.getElementById('remainDuration').value;
 			remd = txt2duration(remdstr)
 			
 			eladstr = document.getElementById('elapsedDuration').value;
 			elad = txt2duration(eladstr)
 			
 			isWorking = document.getElementById('rbWrkBrk_Wrk').checked;

			tme = Date.now(); 	
 			
 			switch (state) {
 				case tmrstate.INIT:
 						
 						// set event time
 						if (isWorking) {
 							dur = wd;
 							state = tmrstate.WORKING
 							workSessionsStartedNum += 1;
							workSessionsStartedSinceLongBreakNum += 1;
 						} else {
 							dur = bd;
 							state = tmrstate.ONBREAK
							if (isLongBreak()) {
								longBreakSessionsStartedNum += 1;
							} else {
								breakSessionsStartedNum += 1;
							}
 						}
 						
 						evtTime = tme+dur
 						startTime = tme
 						
 						var tmrInt = window.window.setInterval(onTmrInt, 500);
 						var tmrEvt = window.setTimeout(onTmrEvt, dur)
 						
 						isRunning = true;
 						
 						alertl('> Tmr initially started.',1)
 						
 					break;
 					
 				case tmrstate.WORKING:
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
 				case tmrstate.ONBREAK:
				case tmrstate.ONLONGBREAK:
 				case tmrstate.BREAKOVER:
				case tmrstate.LONGBREAKOVER:
	 					dur = remDuration
	 					
	 					evtTime = tme+dur
	 					startTime = tme-elaDuration // synthetic, does not include pauses
	 					
	 					var tmrInt = window.window.setInterval(onTmrInt, 500);
	 					var tmrEvt = window.setTimeout(onTmrEvt, dur)
	 					
	 					isRunning = true;
	 					
	 					alertl('> Tmr resumed.',1)
 					
 					break;
 			}
 			
 		}
 		
 		function pauseTmr() {
 			
 			if (!isRunning) {
 				return;
 			}
 			
 			if ((typeof Notif != 'undefined') && Notif !== null) {
 				Notif.close();
 			}
 			isNotifying = false;
 			
 			tme = Date.now();
 			
 			switch (state) {
 				case tmrstate.INIT: // this should never happen
 						
 						isWorking = document.getElementById('rbWrkBrk_Wrk').checked;
 						
 						// set event time
 						if (isWorking) {
 							dur = wd;
 							state = tmrstate.WORKING
 						} else {
 							dur = bd;
 							state = tmrstate.ONBREAK
 						}
 						
 						evtTime = tme+dur
 						remDuration = dur;
 						elaDuration = 0;
 						
 						if ((typeof tmrInt !== 'undefined') && (tmrInt !== null)) { 
 							window.clearInterval(tmrInt);
 							tmrInt = null;
 						}
 						
 						if ((typeof tmrEvt !== 'undefined') && (tmrEvt !== null)) { 
 							window.clearInterval(tmrEvt);
 							tmrEvt = null;
 						}
 						
 						isRunning = false;
 						
 						
 					break;
 					
 				case tmrstate.WORKING:
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
 				case tmrstate.ONBREAK:
				case tmrstate.ONLONGBREAK:
 				case tmrstate.BREAKOVER:
				case tmrstate.LONGBREAKOVER:
	 					remDuration = evtTime - tme // negative: elapsed since event
	 					elaDuration = tme - startTime
	 					
	 					//evtTime = tme+dur
	 					
	 					if ((typeof tmrInt !== 'undefined') && (tmrInt !== null)) { 
							window.clearInterval(tmrInt);
							tmrInt = null;
						}
						
						if ((typeof tmrEvt !== 'undefined') && (tmrEvt !== null)) { 
							window.clearInterval(tmrEvt);
							tmrEvt = null;
						}
						
						isRunning = false;
	 					
	 				break;
 			}
 			
 			document.getElementById('frmTmr').className = 'paused'
 			
 			alertl('> Tmr paused.',1)
 		}
 		
 		function determineWorkDuration() {
 			wdstr = document.getElementById('workDuration').value;
 			wd = txt2duration(wdstr)
 			
			dur = wd;
			
			return dur;
 		}
 		
 		
		function isLongBreak() {
			wdstr = document.getElementById('workDuration').value;
 			wd = txt2duration(wdstr)
 			
 			bdstr = document.getElementById('breakDuration').value;
 			bd = txt2duration(bdstr)
 			
 			lbdstr = document.getElementById('longBreakDuration').value;
 			lbd = txt2duration(lbdstr)
 			
 			lbastr = document.getElementById('longBreakAfter').value;
 			lba = parseInt(lbastr)
 			
 			enableLongbreaks = document.getElementById('cbEnableLongBreaks').checked;
 			longbreaksCountFinishedWork = document.getElementById('cbLongbreaksCountOnlyCompletedWork').checked;
 			
 			dur = -1;
 			
 			if (longbreaksCountFinishedWork != true) {
				workSessionsNum = workSessionsStartedSinceLongBreakNum;
			} else {
				workSessionsNum = workSessionsFinishedSinceLongBreakNum;
			}
			
			if ((state == tmrstate.ONLONGBREAK) || (state == tmrstate.LONGBREAKREQUIRED) || (state == tmrstate.LONGBREAKOVER)) {
				// state says its a long break (maybe entered manually)
				return true;
			}
			
			// determine if long break by rule
			if ((lbd >= 0) && (lba > 0) && (enableLongbreaks == true) && (workSessionsNum > 0) && (workSessionsNum >= lba)) { 
				// long break required
				return true;
				
			} else {
				// standard break
				return false;
			}
		}
		
		function getShortBreakDuration() {
			var bdstr = document.getElementById('breakDuration').value;
 			var bd = txt2duration(bdstr)
			return bd;
		}
		function getLongBreakDuration() {
			var lbdstr = document.getElementById('longBreakDuration').value;
 			var lbd = txt2duration(lbdstr)
			return lbd;
		}
 		function determineBreakDuration() {
 			 			
 			var bd = getShortBreakDuration();
 			var lbd = getLongBreakDuration();
 			
 			var dur = -1; 					
			// determine if long break
			//if ((lbd >= 0) && (lba > 0) && (enableLongbreaks == true) && ((workSessionsNum % lba) == 0)) {
			if (isLongBreak()) {
				// long break required
				dur = lbd;		
			} else {
				// standard break
				dur = bd;
			}
			//alertl("DEBUG: bd="+duration2txt(dur),3)
			return dur;
 		}
 		
 		function StartBreakFromNotification(event) {
			if ( !(document.getElementById('cbFocusTmrOnBreak').checked) ) { 
 				event.preventDefault();	// prevent context switch 
			} else {
				// context switch so the break is encouraged
			}
 			
 			alertl('Notification action='+event.action,3)
 			if ((event.action === 'apply') || (event.action === 'undefined')) {
 				StartBreak()
 			} else if (event.action === 'pause') {
 				pauseTmr()
 			} else {
 				StartBreak()
 			}
 		}
 		
 		function StartBreak(StartBreakType) {
			
 			if (!isRunning) {
 				startTmr()
 			}
 			if ((typeof Notif != 'undefined') && Notif !== null) {
 				Notif.close();
 			}
 			isNotifying = false;
 			
 			switch (state) {
 				case tmrstate.INIT:
 						return
 					break;
 				case tmrstate.WORKING:
						//ok 
	 				break;
 				case tmrstate.BREAKREQUIRED:
						//ok
	 				break;
				case tmrstate.LONGBREAKREQUIRED:
 						//ok
	 				break;
 				case tmrstate.ONBREAK:
				case tmrstate.ONLONGBREAK:
 						return;
	 				break;
 				case tmrstate.BREAKOVER:
				case tmrstate.LONGBREAKOVER:
 						return;
	 				break;
 			}
			
 			tme = Date.now();
 			remDuration = evtTime - tme // negative: elapsed
 			
 			elaDuration = tme - startTime;
 			workSum+=elaDuration;
 			eladstr = duration2txt(elaDuration);
			
			performAutosave()
			
			
			if ((StartBreakType == undefined) || (StartBreakType == null) || ((typeof(StartBreakType) != 'breaktype') && (typeof(StartBreakType) != 'string')) || (StartBreakType == breaktype.UNDEFINEDBREAK)) {
				var longb = isLongBreak();
				var dur = determineBreakDuration();
			} else if (StartBreakType == breaktype.SHORTBREAK) {
				var longb = false;
				var dur = getShortBreakDuration();
			} else if (StartBreakType == breaktype.LONGBREAK) {
				var longb = true;
				var dur = getLongBreakDuration();
			} else { // should never happen
				console.log('Uncatched case in StartBreak for StartBreakType. Defaulting')
				var longb = isLongBreak();
				var dur = determineBreakDuration();
			}
 			
			
			alertl(' # Starting '+(longb?'long ':'')+'break after working for '+eladstr+'.',1)
 			
 			elaDuration = 0;
 			startTime = tme

 			autoswitchtowork  = document.getElementById('cbAutoSwitchToWork').checked;
			autoswitchtobreak = document.getElementById('cbAutoSwitchToBreak').checked;
 			
 			//wdstr = document.getElementById('workDuration').value;
 			//wd = txt2duration(wdstr)
 			
 			//bdstr = document.getElementById('breakDuration').value;
 			//bd = txt2duration(bdstr)
 			
 			//lbdstr = document.getElementById('longBreakDuration').value;
 			//lbd = txt2duration(lbdstr)
 			
 			//lbastr = document.getElementById('longBreakAfter').value;
 			//lba = parseInt(lbastr)
 			
 			//enableLongbreaks = document.getElementById('cbEnableLongBreaks').checked;
 			//longbreaksCountFinishedWork = document.getElementById('cbLongbreaksCountOnlyCompletedWork').checked;
 			
 			ndstr = document.getElementById('notifyDuration').value;
 			nd = txt2duration(ndstr)
 			
 			remdstr = document.getElementById('remainDuration').value;
 			remd = txt2duration(remdstr)
 			
 			isWorking = document.getElementById('rbWrkBrk_Wrk').checked;
 			
 			
 			
			if (longb) {
				state = tmrstate.ONLONGBREAK
				longBreakSessionsStartedNum += 1;
			} else {
				state = tmrstate.ONBREAK;
				breakSessionsStartedNum += 1;
			}
 							
			isWorking = false;
			document.getElementById('rbWrkBrk_Brk').checked = true
			document.getElementById('rbWrkBrk_Wrk').checked = false
			
			//alertl("DEBUG2: bd="+duration2txt(dur),3)
			
			if (longb) {
				var msg = ('> Long break (for '+duration2txt(dur)+') started.')
			} else {
				var msg = ('> Break (for '+duration2txt(dur)+') started.')
			}
		
			evtTime = tme+dur
		
			var tmrEvt = window.setTimeout(onTmrEvt, dur)
			
			
			
			alertl(msg,1)
 		}
 		
 		function StartWorkFromNotification(event) {
 			event.preventDefault();
 			
 			alertl('Notification action='+event.action,3)
 			if ((event.action === 'apply') || (event.action === 'undefined')) {
 				StartWork()
 			} else if (event.action === 'pause') {
 				pauseTmr()
 			} else {
 				StartWork()
 			}
 		}
 		
 		function StartWork() {
 			if (!isRunning) {
 				startTmr()
 			}
 			if ((typeof Notif != 'undefined') && Notif !== null) {
 				Notif.close();
 			}
 			isNotifying = false;
			
			
 			switch (state) {
 				case tmrstate.INIT:
 						return;
 					break;
 				case tmrstate.WORKING:
						return;
	 				break;
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
 						return;
	 				break;
 				case tmrstate.ONBREAK:
						// ok
					break;
				case tmrstate.ONLONGBREAK:
 						// ok
						// workSessionsStartedSinceLongBreakNum = 0; // when a long break is cancelled, be insistent and require a complete long break next time
						// workSessionsFinishedSinceLongBreakNum = 0;
	 				break;
 				case tmrstate.BREAKOVER:
						// ok
	 				break;
				case tmrstate.LONGBREAKOVER:
 						// ok
						workSessionsStartedSinceLongBreakNum = 0; // after competing a long break, reset counters
						workSessionsFinishedSinceLongBreakNum = 0;
	 				break;
 			}
			
 			workSessionsStartedNum += 1;
			workSessionsStartedSinceLongBreakNum += 1;
 			
 			tme = Date.now();
 			remDuration = evtTime - tme // negative: elapsed
 			
 			elaDuration = tme - startTime;
 			breakSum+=elaDuration;
 			eladstr = duration2txt(elaDuration);
			
			performAutosave()
 			
			
			alertl(' # Starting work after a break of '+eladstr+'.',1)
 			
 			elaDuration = 0;
 			startTime = tme

 			autoswitchtowork  = document.getElementById('cbAutoSwitchToWork').checked;
			autoswitchtobreak = document.getElementById('cbAutoSwitchToBreak').checked;
 			
 			wdstr = document.getElementById('workDuration').value;
 			wd = txt2duration(wdstr)
 			
 			bdstr = document.getElementById('breakDuration').value;
 			bd = txt2duration(bdstr)
 			
 			ndstr = document.getElementById('notifyDuration').value;
 			nd = txt2duration(ndstr)
 			
 			remdstr = document.getElementById('remainDuration').value;
 			remd = txt2duration(remdstr)
 			
 			isWorking = document.getElementById('rbWrkBrk_Wrk').checked;
 			
 			
 			
 			state = tmrstate.WORKING
 							
			isWorking = true;
			document.getElementById('rbWrkBrk_Wrk').checked = true
			document.getElementById('rbWrkBrk_Brk').checked = false
		
			dur = wd;
			evtTime = tme+dur
		
			var tmrEvt = window.setTimeout(onTmrEvt, dur)
			
			alertl('> Work started (for '+duration2txt(wd)+').',1)
 		}
 		
		
		function getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum) {
			var mxv  = Math.max(workSessionsStartedNum, workSessionsFinishedNum, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
			var flen = Math.floor(Math.log(mxv)/Math.log(10))+1;
			var statsstr = duration2txt(workSum)+' of work sessions: \n  total: ('+prepad(workSessionsStartedNum.toString(),flen,' ')+' started), ('+prepad(workSessionsFinishedNum.toString(),flen,' ')+' finished)\n         ('+prepad(workSessionsStartedSinceLongBreakNum.toString(),flen,' ')+' started), ('+prepad(workSessionsFinishedSinceLongBreakNum.toString(),flen,' ')+' finished) since long break ' + '\n' + duration2txt(breakSum)+' of break sessions: \n  short: ('+prepad(breakSessionsStartedNum.toString(),flen,' ')+' started), ('+ prepad(breakSessionsFinishedNum.toString(),flen,' ') +' finished) \n  long:  ('+prepad(longBreakSessionsStartedNum.toString(),flen,' ')+' started), ('+ prepad(longBreakSessionsFinishedNum.toString(),flen,' ') +' finished) ';
			return statsstr;
		}
		
 		function displayStatus(state, running, txt) {
			document.title = ((isRunning)? '':'Tmr Stopped. ') + state2strshort(state) + " (Work/Break Tmr)";
			document.getElementById('edtstatus').value= txt;
		}
		
		
		function renderTmrState() {
			dto = new Date()
			
			tme = Date.now();
 			//remDuration = evtTime - tme // negative: elapsed // do NOT recalculate in render routine, this only happens in tick
 			//elaDuration = tme - startTime  // do NOT recalculate in render routine, this only happens in tick
			
			document.getElementById('workSum').value = duration2txt(workSum);
 			document.getElementById('breakSum').value = duration2txt(breakSum);
			
 			displayStatus(state,isRunning, state2str(state) + ", tmr is "+ ((isRunning)? 'running':'stopped') );
 			document.getElementById('edtstatus').title = 'TZ'+((dto.getTimezoneOffset() >= 0)? '+':'')+ dto.getTimezoneOffset().toString()
 			statsstr = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
 			document.getElementById('edtstatistics').value= statsstr;
			
			remdstr = duration2txt(remDuration);
 			document.getElementById('remainDuration').value = remdstr;
 			
 			eladstr = duration2txt(elaDuration);
 			document.getElementById('elapsedDuration').value =eladstr;
 			
			if ((evtTime != undefined) && (evtTime > 0)) {
				wbtme = new Date(evtTime)
				wrkbrktimestr = fmtDateTime(wbtme);
				document.getElementById('WrkBrkTime').value = wrkbrktimestr;
			}
				
 			tmeobj = new Date(tme)
 			tmestr = fmtDateTime(tmeobj);
 			document.getElementById('DateTime').value = tmestr;
 			
			ndstr = document.getElementById('notifyDuration').value;
 			nd = txt2duration(ndstr)
			subsymbol = ''
 			if ((remDuration >= 0) && (remDuration <= nd) && (state != tmrstate.INIT)) {
 				subsymbol = '_ending';
 			}
 			document.getElementById('symbolimg').src = state.toString()+subsymbol+'.png';
			
			if (isLongBreak()) {
				document.getElementById('btnBreak').value = "Take (long) Break";
			} else {
				document.getElementById('btnBreak').value = "Take (short) Break";
			}
			
		}
		
 		function tickTmr() {
 			dto = new Date()
			
 			displayStatus(state,isRunning, state2str(state) + ", tmr is "+ ((isRunning)? 'running':'stopped') );
 			document.getElementById('edtstatus').title = 'TZ'+((dto.getTimezoneOffset() >= 0)? '+':'')+ dto.getTimezoneOffset().toString()
 			//statsstr = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum, breakSessionsStartedNum, breakSessionsFinishedNum);
 			//document.getElementById('edtstatistics').value= statsstr;
 			
 			if (!isRunning) { 
 				return; 
 			}
 			
 			tme = Date.now();
 			remDuration = evtTime - tme // negative: elapsed
 			elaDuration = tme - startTime

 			autoswitchtowork  = document.getElementById('cbAutoSwitchToWork').checked;
			autoswitchtobreak = document.getElementById('cbAutoSwitchToBreak').checked;
 			
 			wdstr = document.getElementById('workDuration').value;
 			wd = txt2duration(wdstr)
 			
 			bdstr = document.getElementById('breakDuration').value;
 			bd = txt2duration(bdstr)
 			
 			lbdstr = document.getElementById('longBreakDuration').value;
 			lbd = txt2duration(lbdstr)
 			
 			lbastr = document.getElementById('longBreakAfter').value;
 			lba = parseInt(lbastr)
 			
 			enableLongbreaks = document.getElementById('cbEnableLongBreaks').checked;
 			
 			ndstr = document.getElementById('notifyDuration').value;
 			nd = txt2duration(ndstr)
 			
 			remdstr = document.getElementById('remainDuration').value;
 			remd = txt2duration(remdstr)
 			
 			eladstr = document.getElementById('elapsedDuration').value;
 			elad = txt2duration(eladstr)
 			
 			isWorking = document.getElementById('rbWrkBrk_Wrk').checked;
			onclickfn = null;
			
			
 			switch (state) {
 				case tmrstate.INIT: // this should never happen
 					break;
 					
 				case tmrstate.WORKING:
				
				 	document.getElementById('edtstatistics').value = getStatsStr(workSum + elaDuration, workSessionsStartedNum, workSessionsFinishedNum, breakSum, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
 			
 					if (remDuration < 0) {
 						if (!autoswitchtobreak) {
							if (isLongBreak()) {
								state = tmrstate.LONGBREAKREQUIRED
							} else {
								state = tmrstate.BREAKREQUIRED;
							}
 							
 							workSessionsFinishedNum += 1;
							workSessionsFinishedSinceLongBreakNum += 1;
 							
 							onclickfn = window['StartBreakFromNotification'];
 							applymsg = 'Start my break';
 							alertl('> Break required.',1)
 						} else {
 							if (isLongBreak()) {
								state = tmrstate.LONGBREAKREQUIRED
							} else {
								state = tmrstate.BREAKREQUIRED;
							}
							
 							workSessionsFinishedNum += 1;
							workSessionsFinishedSinceLongBreakNum += 1;
 							
 							if (document.getElementById('cbPlayAudio').checked) {
				 				try {
				 				  var audio = document.getElementById('audio_'+state.toString()); audio.play();
				 				  alertl('Play audio '+audio.id,3);
				 				} catch(err) {
								  alertl(err.message,3);
								}
				 			}
 							
 							alertl('> Break required, autostarting break...',1)
 							
 							StartBreak();
 							
 							tme = Date.now();
				 			remDuration = evtTime - tme // negative: elapsed
				 			elaDuration = tme - startTime
	 						
 						}
 					}
 				
	 				break;
 				case tmrstate.BREAKREQUIRED:
				case tmrstate.LONGBREAKREQUIRED:
					document.getElementById('edtstatistics').value = getStatsStr(workSum + elaDuration, workSessionsStartedNum, workSessionsFinishedNum, breakSum, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
	 				break;
 				case tmrstate.ONBREAK:
					document.getElementById('edtstatistics').value = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum + elaDuration, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
				
 					if (remDuration < 0) {
 						if (!autoswitchtowork) {
 							state = tmrstate.BREAKOVER
 							
 							breakSessionsFinishedNum += 1;
 							
 							onclickfn = window['StartWorkFromNotification'];
 							applymsg = 'Start working';
 							alertl('> Break over.',1)
 						} else {
 							state = tmrstate.BREAKOVER
 							breakSessionsFinishedNum += 1;
 							
 							if (document.getElementById('cbPlayAudio').checked) {
				 				try {
				 				  var audio = document.getElementById('audio_'+state.toString()); audio.play();
				 				  alertl('Play audio '+audio.id,3);
				 				} catch(err) {
								  alertl(err.message,3);
								}
				 			}
 							
 							alertl('> Break over, autostarting work...',1)
 							StartWork();
 							
 							tme = Date.now();
				 			remDuration = evtTime - tme // negative: elapsed
				 			elaDuration = tme - startTime
	 						
 						}
 					}
					break;
				case tmrstate.ONLONGBREAK:
					document.getElementById('edtstatistics').value = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum + elaDuration, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
				
 					if (remDuration < 0) {
 						if (!autoswitchtowork) {
 							state = tmrstate.LONGBREAKOVER
 							
 							longBreakSessionsFinishedNum += 1;
 							
 							onclickfn = window['StartWorkFromNotification'];
 							applymsg = 'Start working';
 							alertl('> Long break over.',1)
 						} else {
 							state = tmrstate.LONGBREAKOVER
 							longBreakSessionsFinishedNum += 1;
 							
 							if (document.getElementById('cbPlayAudio').checked) {
				 				try {
				 				  var audio = document.getElementById('audio_'+state.toString()); audio.play();
				 				  alertl('Play audio '+audio.id,3);
				 				} catch(err) {
								  alertl(err.message,3);
								}
				 			}
 							
 							alertl('> Long break over, autostarting work...',1)
 							StartWork();
 							
 							tme = Date.now();
				 			remDuration = evtTime - tme // negative: elapsed
				 			elaDuration = tme - startTime
	 						
 						}
 					}
	 				break;
 				case tmrstate.BREAKOVER:
					document.getElementById('edtstatistics').value = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum+elaDuration, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
	 				break;
				case tmrstate.LONGBREAKOVER:
					document.getElementById('edtstatistics').value = getStatsStr(workSum, workSessionsStartedNum, workSessionsFinishedNum, breakSum+elaDuration, breakSessionsStartedNum, breakSessionsFinishedNum, longBreakSessionsStartedNum, longBreakSessionsFinishedNum,  workSessionsStartedSinceLongBreakNum, workSessionsFinishedSinceLongBreakNum);
	 				break;
 			}
 			
 			document.getElementById('frmTmr').className = state.toString();
 			
 			if (Math.abs(remDuration) < nd) {
 				document.getElementById('frmTmr').classList.add('notify');
 				if ((!isNotifying) && (onclickfn !== null)) {
 					isNotifying = true;
 					if (document.getElementById('cbDesktopNotify').checked) {
 						alertl('Notifying...',3);
 						Notif = showDesktopNotification(state2str(state), state2strlong(state), state.toString()+'.png', onclickfn, null, applymsg);
 					}
 					
 					if (document.getElementById('cbPlayAudio').checked) {
		 				try {
		 				  //var audiofile = state.toString()+'.mp3';
		 				  //var audio = new Audio(audiofile); audio.play();
		 				  var audio = document.getElementById('audio_'+state.toString()); audio.play();
		 				  
		 				  alertl('Play audio '+audio.id,3);
		 				} catch(err) {
						  alertl(err.message,3);
						}
		 			}
 				}
 			} else if ((remDuration) < (-1)*nd) {
 				document.getElementById('frmTmr').classList.add('notifyoverdue')
 			}
 			
 			subsymbol = ''
 			if ((remDuration >= 0) && (remDuration <= nd)) {
 				subsymbol = '_ending';
 			}
 			
 			
 			remdstr = duration2txt(remDuration);
 			document.getElementById('remainDuration').value = remdstr;
 			
 			eladstr = duration2txt(elaDuration);
 			document.getElementById('elapsedDuration').value =eladstr;
 			
 			wbtme = new Date(evtTime)
 			wrkbrktimestr = fmtDateTime(wbtme);
 			document.getElementById('WrkBrkTime').value = wrkbrktimestr;
 			
 			tmeobj = new Date(tme)
 			tmestr = fmtDateTime(tmeobj);
 			document.getElementById('DateTime').value = tmestr;
 			
 			document.getElementById('symbolimg').src = state.toString()+subsymbol+'.png';
			
			if (isLongBreak()) {
				document.getElementById('btnBreak').value = "Take (long) Break";
			} else {
				document.getElementById('btnBreak').value = "Take (short) Break";
			}
 			
 			
 			document.getElementById('workSum').value = duration2txt(workSum);
 			document.getElementById('breakSum').value = duration2txt(breakSum);
 			
 		}
 		
 		function fmtDateTime(dto) {
 			str = prepad(dto.getFullYear(),4,'0') +'-'+ prepad(dto.getMonth()+1,2,'0') +'-'+ prepad(dto.getDate()+1,2,'0') +' '+prepad(dto.getHours(),2,'0')+":"+prepad(dto.getMinutes(),2,'0')+":"+prepad(dto.getSeconds(),2,'0')+""
 			return str;
 		}
 		
 		
 		function handleValid (el,res) {
 			if (!res) {
 				el.classList.remove('is-valid');
 				el.classList.add('is-invalid');
 			} else {
 				el.classList.remove('is-invalid');
 				el.classList.add('is-valid');
 			}
 		}
 		
 		function txt2duration(str) {
 			arr = str.split(':');
 			switch (arr.length) {
 				case 2: 
 					h = parseInt(arr[0],10); 
 					m = parseInt(arr[1],10);
 					s = 0;
 					break;
 				case 3: 
 					h = parseInt(arr[0],10); 
 					m = parseInt(arr[1],10);
 					s = parseInt(arr[2],10);
 					break;
 				default: 
 					h = 0;
 					m = 5;
 					s = 0;
 				
 			}
 			sgn = 1;
 			if (h<0) {
 				h=h*(-1);
 				sgn = sgn*(-1);
 			}
 			
 			if (m<0) {
 				m=m*(-1);
 				sgn = sgn*(-1);
 			}
 			
 			if (s<0) {
 				s=s*(-1);
 				sgn = sgn*(-1);
 			}
 			
 			dur = sgn*(h*60*60 + m*60 + s);
 			return dur*1000;
 		}
 		
		function prepad(n, width, z) {
		  z = z || '0';
		  n = n + '';
		  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
		}
 		
 		function duration2txt(dur) {
 			if (dur < 0) {
 				dur = dur*(-1);
 				sgn = '-';
 			} else {
 				sgn = '';
 			}
 			
 			dur = dur/1000; // ms to sec
 			
 			h = Math.floor(dur/(60*60))
 			m = Math.floor((dur-h*60*60)/(60))
 			s1 = ((dur-h*60*60 -m*60))
 			s = Math.round(s1);
 			
 			txt = sgn + prepad(h.toString(),2,'0') + ':' + prepad(m.toString(),2,'0') + ':' + prepad(s.toString(),2,'0');
 			return txt;
 		}
 		
 		
 		function validateInput() {
 			result = true;
 			//var el = document.querySelectorAll('#workDuration')[0];
 			var el = document.getElementById('workDuration');
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			var el = document.getElementById('breakDuration')
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			var el = document.getElementById('longBreakDuration')
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			var el = document.getElementById('longBreakAfter')
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			var el = document.getElementById('notifyDuration')
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			var el = document.getElementById('remainDuration')
 			var res = el.checkValidity();
 			handleValid(el,res);
 			result = result && res;
 			
 			
 			return result;
 			
 		}
 		
 		
 		function showDesktopNotification(title, msg, iconurl, onclickfn, onclosefn, applymsg) {
 			
		    if (!window.Notification) {
				alertl('Browser does not support notifications.',3);
			} else {
				// check if permission is already granted
				if (Notification.permission === 'granted') {
					// show notification here
					var notify = new Notification(title, {
						body: msg,
						icon: iconurl,
						requireInteraction: true,
						onclick: onclickfn,
						onclose: onclosefn,
						/*actions: [
									{ action: 'apply',
									  title: applymsg  },
									{ action: 'pause',
									  title: 'Pause Tmr'  },
								  ],*/
					});
					notify.onclick = onclickfn;
					notify.onclose = onclosefn;
					return notify;
				} else {
					// request permission from user
					Notification.requestPermission().then(function (p) {
						if (p === 'granted') {
							// show notification here
							var notify = new Notification(title, {
								body: msg,
								icon: iconurl,
								requireInteraction: true, 
								onclick: onclickfn,
								onclose: onclosefn,
								/*actions: [
											{ action: 'apply',
											  title: applymsg  },
											{ action: 'pause',
											  title: 'Pause Tmr'  },
										  ],*/
							});
							notify.onclick = onclickfn;
							notify.onclose = onclosefn;
						} else {
							console.log('User blocked notifications.');
							alertl('User blocked notifications.',3);
						}
					}).catch(function (err) {
						console.error(err);
						alertl(err,3);
					});
					return notify;
				}
			}
		}
		
		
		/// (auto)save
		
		function getTmrState() {
			var tstate = {};
			
			tstate = _getTmrFormState(tstate);

			tstate["startTime"] = startTime
			tstate["startTime"] = startTime; // only valid when running, time when work/break started
			tstate["evtTime"] = evtTime; // only valid when running, time when work/break ends/ended
			tstate["remDuration"] = remDuration; // only valid when paused: remaining duration
			tstate["elaDuration"] = elaDuration; // only valid when paused: elapsed duration
			tstate["workSum"] = workSum;
			tstate["breakSum"] = breakSum;
			tstate["workSessionsStartedNum"] = workSessionsStartedNum;
			tstate["workSessionsFinishedNum"] = workSessionsFinishedNum;
			tstate["breakSessionsStartedNum"] = breakSessionsStartedNum;
			tstate["breakSessionsFinishedNum"] = breakSessionsFinishedNum;
			tstate["longBreakSessionsStartedNum"] = longBreakSessionsStartedNum;
			tstate["longBreakSessionsFinishedNum"] = longBreakSessionsFinishedNum;
			tstate["workSessionsStartedSinceLongBreakNum"] = workSessionsStartedSinceLongBreakNum;
			tstate["workSessionsFinishedSinceLongBreakNum"] = workSessionsFinishedSinceLongBreakNum;
			
			tstate["wrkDur"] = wrkDur;
			tstate["brkDur"] = brkDur;
			
			tstate["isNotifying"] = isNotifying;
			tstate["Notif"] = Notif;
			tstate["notify"] = notify;
			
			
			tstate["TmrVersion"] = TmrVersion;
			
			tstate["state"] = state;
			tstate["isRunning"] = isRunning;
		
		
			
			
			TmrGlobalStateList = tstate;
			return tstate;
		}
		
		function _getTmrFormState(tstate) {
			if (tstate["frm"] == undefined) {
				tstate["frm"] = {};
			}
			tstate["frm"]["workDuration"] 			 = document.getElementById("workDuration").value
			tstate["frm"]["breakDuration"] 			 = document.getElementById("breakDuration").value
			tstate["frm"]["longBreakDuration"] 		 = document.getElementById("longBreakDuration").value
			tstate["frm"]["longBreakAfter"] 		 = document.getElementById("longBreakAfter").value
			tstate["frm"]["notifyDuration"] 		 = document.getElementById("notifyDuration").value
			tstate["frm"]["cbAutoSwitchToWork"] 	 = document.getElementById("cbAutoSwitchToWork").checked
			tstate["frm"]["cbAutoSwitchToBreak"] 	 = document.getElementById("cbAutoSwitchToBreak").checked
			tstate["frm"]["cbEnableLongBreaks"] 	 = document.getElementById("cbEnableLongBreaks").checked
			tstate["frm"]["cbLongbreaksCountOnlyCompletedWork"] 	 = document.getElementById("cbLongbreaksCountOnlyCompletedWork").checked
			tstate["frm"]["cbDesktopNotify"] 		 = document.getElementById("cbDesktopNotify").checked
			tstate["frm"]["cbFocusTmrOnBreak"] 		 = document.getElementById("cbFocusTmrOnBreak").checked
			tstate["frm"]["cbPlayAudio"] 			 = document.getElementById("cbPlayAudio").checked
			tstate["frm"]["cbAutoRunOnLoad"] 		 = document.getElementById("cbAutoRunOnLoad").checked
			tstate["frm"]["elapsedDuration"] 		 = document.getElementById("elapsedDuration").value
			tstate["frm"]["remainDuration"] 		 = document.getElementById("remainDuration").value
			tstate["frm"]["DateTime"] 				 = document.getElementById("DateTime").value
			tstate["frm"]["WrkBrkTime"] 			 = document.getElementById("WrkBrkTime").value
			tstate["frm"]["rbWrkBrk_Wrk"] 			 = document.getElementById("rbWrkBrk_Wrk").checked
			tstate["frm"]["rbWrkBrk_Brk"] 			 = document.getElementById("rbWrkBrk_Brk").checked
			tstate["frm"]["edtstatus"] 				 = document.getElementById("edtstatus").value
			tstate["frm"]["workSum"] 				 = document.getElementById("workSum").value
			tstate["frm"]["breakSum"] 				 = document.getElementById("breakSum").value
			tstate["frm"]["edtstatistics"] 			 = document.getElementById("edtstatistics").value
			tstate["frm"]["cbDebugLog"] 			 = document.getElementById("cbDebugLog").checked
			tstate["frm"]["tlog"] 					 = document.getElementById("tlog").value

			return tstate
		}
		
		function _restoreTmrFormState(tstate) {
			if (tstate["frm"] == undefined) {
				return false;
			}
			try {
				document.getElementById("workDuration").value			 = tstate["frm"]["workDuration"];
				document.getElementById("breakDuration").value			 = tstate["frm"]["breakDuration"];
				document.getElementById("longBreakDuration").value		 = tstate["frm"]["longBreakDuration"];
				document.getElementById("longBreakAfter").value			 = tstate["frm"]["longBreakAfter"];
				document.getElementById("notifyDuration").value			 = tstate["frm"]["notifyDuration"];
				document.getElementById("cbAutoSwitchToWork").checked	 = tstate["frm"]["cbAutoSwitchToWork"];
				document.getElementById("cbAutoSwitchToBreak").checked	 = tstate["frm"]["cbAutoSwitchToBreak"];
				document.getElementById("cbEnableLongBreaks").checked	 = tstate["frm"]["cbEnableLongBreaks"];
				document.getElementById("cbLongbreaksCountOnlyCompletedWork").checked	 = tstate["frm"]["cbLongbreaksCountOnlyCompletedWork"];
				document.getElementById("cbDesktopNotify").checked		 = tstate["frm"]["cbDesktopNotify"];
				document.getElementById("cbFocusTmrOnBreak").checked	 = tstate["frm"]["cbFocusTmrOnBreak"];
				document.getElementById("cbPlayAudio").checked			 = tstate["frm"]["cbPlayAudio"];
				document.getElementById("cbAutoRunOnLoad").checked		 = tstate["frm"]["cbAutoRunOnLoad"];
				document.getElementById("elapsedDuration").value		 = tstate["frm"]["elapsedDuration"];
				document.getElementById("remainDuration").value			 = tstate["frm"]["remainDuration"];
				document.getElementById("DateTime").value				 = tstate["frm"]["DateTime"];
				document.getElementById("WrkBrkTime").value				 = tstate["frm"]["WrkBrkTime"];
				document.getElementById("rbWrkBrk_Wrk").checked			 = tstate["frm"]["rbWrkBrk_Wrk"];
				document.getElementById("rbWrkBrk_Brk").checked			 = tstate["frm"]["rbWrkBrk_Brk"];
				document.getElementById("edtstatus").value				 = tstate["frm"]["edtstatus"];
				document.getElementById("workSum").value				 = tstate["frm"]["workSum"];
				document.getElementById("breakSum").value				 = tstate["frm"]["breakSum"];
				document.getElementById("edtstatistics").value			 = tstate["frm"]["edtstatistics"];
				document.getElementById("cbDebugLog").checked			 = tstate["frm"]["cbDebugLog"];

				var oldlog = tstate["frm"]["tlog"];
				if (typeof(oldlog) != "string") {
					oldlog = "Error: non-string-data encountered.";
				}
				dt = fmtDateTime(dto)+'.';
				document.getElementById("tlog").value					 = "\r\n"+dt+"--- end of restored log --- \r\n" + oldlog + "\r\n"+dt+"^^^ restored log ^^^ \r\n" + document.getElementById("tlog").value; // exception: keep current log
			} catch (e) {
				alertl(e,3);
				return false;
			}
			return true;
		}
		
		function restoreTmrState(tstate) {
		
			_restoreTmrFormState(tstate); // restore gui
			
			//startTime = tstate["startTime"]; // only valid when running, time when work/break started
			//evtTime = tstate["evtTime"]; // only valid when running, time when work/break ends/ended
			//remDuration = tstate["remDuration"]; // only valid when paused: remaining duration
			//elaDuration = tstate["elaDuration"]; // only valid when paused: elapsed duration
			workSum = tstate["workSum"];
			breakSum = tstate["breakSum"];
			workSessionsStartedNum = tstate["workSessionsStartedNum"];
			workSessionsFinishedNum = tstate["workSessionsFinishedNum"];
			breakSessionsStartedNum = tstate["breakSessionsStartedNum"];
			breakSessionsFinishedNum = tstate["breakSessionsFinishedNum"];
			longbreakSessionsStartedNum  = tstate["longBreakSessionsStartedNum"];
			longbreakSessionsFinishedNum = tstate["longBreakSessionsFinishedNum"];
			workSessionsStartedSinceLongBreakNum  = tstate["workSessionsStartedSinceLongBreakNum"];
			workSessionsFinishedSinceLongBreakNum = tstate["workSessionsFinishedSinceLongBreakNum"];
			
			wrkDur = tstate["wrkDur"];
			brkDur = tstate["brkDur"];
			
			//isNotifying = tstate["isNotifying"];
			//Notif = tstate["Notif"];
			//notify = tstate["notify"];
			
			//state = tstate["state"];
			//isRunning = tstate["isRunning"];
			
			TmrGlobalStateList = tstate;
			
			//renderTmrState();
			
			return true;
			// after calling, run renderTmrState() to update gui with internal state.
		}
		
		function saveToLocalStorageUser() {
			if (true || (TmrGlobalStateList == undefined) || (TmrGlobalStateList == null) || (isEmptyObj(TmrGlobalStateList))) { // always force update here to prevent flaws from event updates to cause problems
				console.log('saveToLocalStorageUser: Initializing TmrGlobalStateList')
				TmrGlobalStateList = getTmrState() // init
			}

			window.localStorage.setItem("TmrGlobalStateListUser",JSON.stringify(TmrGlobalStateList))
			window.localStorage.setItem("TmrVersionUser",TmrVersion)

			console.log('saveToLocalStorageUser: State saved.')

			
			alert('Saving complete. \n')

		}
		function restoreFromLocalStorageUser() {
            var tmr_state = JSON.parse(window.localStorage.getItem("TmrGlobalStateListUser"))
			var ver   = window.localStorage.getItem("TmrVersionUser")

			if (tmr_state == null || ver == null) {
				console.log('restoreFromLocalStorageUser: no data in localStorage. Nothing to restore.')
				alert("Nothing in userspace of local storage.")
				return false;
			}

			if (ver != TmrVersion) {
				if (!window.confirm("Saved version is of version "+ver+" ("+tmr_state['TmrVersion']+") but current document is version "+TmrVersion+". Saved state may differ from what is being loaded. Proceed?")) {
					console.log("restoreFromLocalStorageUser: version '"+ver+"' of stored data in localStorage differs from document version '"+TmrVersion+"'. Cannot restore safely. Aborting restore as requested.")
					return false
				} else {
					console.log("restoreFromLocalStorageUser: version '"+ver+"' of stored data in localStorage differs from document version '"+TmrVersion+"'. Cannot restore safely. Continuing restore anyways as requested.")
				}
			}

            TmrGlobalStateList = tmr_state;

			delete tmr_state['TmrVersion']; // remove the version field, which should not be restored.
			restoreTmrState(tmr_state); // load all states
			
			renderTmrState();

            console.log("restoreFromLocalStorageUser: Restore successfully completed.");

			alert('Restore complete. \n')
            
			return true;
		}
		function clearLocalStorageUser() {
			if (!window.confirm("Clear local storage USER data? This cannot be undone. Unloaded states will be lost. Continue with deletion?")) { return; }

            window.localStorage.removeItem("TmrGlobalStateListUser")
			window.localStorage.removeItem("TmrVersionUser")
			console.log("clearLocalStorageUser: Done.");
		}
		function clearAutosave() {
			if (!window.confirm("Clear local storage autosave data? This cannot be undone. Unloaded states will be lost. Continue with deletion?")) { return; }

            window.localStorage.removeItem("TmrGlobalStateListAuto")
			window.localStorage.removeItem("TmrVersionAuto")
			console.log("clearAutosave: Done.");
		}

		function clearLocalStorageAll() {
			if (!window.confirm("Clear ALL local storage data? This cannot be undone. Unloaded states will be lost. Continue with deletion?")) { return; }
			
            window.localStorage.clear()
			console.log("clearLocalStorageAll: Done.");
		}

		function restoreFromAutosave() {
			// plain or manual autorestore
			
			var tmr_state = JSON.parse(window.localStorage.getItem("TmrGlobalStateListAuto"))
			var ver   = window.localStorage.getItem("TmrVersionAuto")

			if (tmr_state == null || ver == null) {
				console.log('performAutorestore: no data in localStorage. Nothing to restore.')
				return false;
			}

			if (ver != TmrVersion) {
				console.log("performAutorestore: version '"+ver+"' of stored data in localStorage differs from document version '"+TmrVersion+"'. Cannot restore safely. Aborting restore.")
				return false;
			}


            TmrGlobalStateList = tmr_state;

			delete tmr_state['TmrVersion']; // remove the version field, which should not be restored.
			restoreTmrState(tmr_state); // load all states

			renderTmrState();
			
            console.log("performAutorestore: Restore successfully completed.");
			
			alertl("Restore from Autosave data complete.",1);
			return true;
		}
		
		function performAutorestore() {
			// autorestore at script startup
			clearLog();
		
			
			var tmr_state_usr = JSON.parse(window.localStorage.getItem("TmrGlobalStateListUser"))
			var ver_usr   = window.localStorage.getItem("TmrVersionUser")
			
			// check if userdata has the autorun flag set
			if ((tmr_state_usr != null) && (tmr_state_usr != undefined) && (tmr_state_usr["frm"] != null) && (tmr_state_usr["frm"] != undefined)
			    && (tmr_state_usr["frm"]["cbAutoRunOnLoad"] != null) && (tmr_state_usr["frm"]["cbAutoRunOnLoad"] != undefined) ) {
				if ((tmr_state_usr["frm"]["cbAutoRunOnLoad"] == true) || (tmr_state_usr["frm"]["cbAutoRunOnLoad"] == 1)) {
					if ((ver_usr == null) || (ver_usr != TmrVersion)) {
						alertl("Performing autorun failed, version mismatch of stored userdata in local storage. Save userdata again to fix this.",1);
					} else {
						alertl("--- Performing autorun as requested by local storage userdata...",1);
						
						TmrGlobalStateList = tmr_state_usr;

						delete tmr_state_usr['TmrVersion']; // remove the version field, which should not be restored.
						restoreTmrState(tmr_state_usr); // load all states

						renderTmrState();
						
						console.log("performAutorestore: Restore of usersave successfully completed.");
						
						alertl("--- Autorun-restore complete, starting work.",1);
						
						StartWork();
						
						console.log("performAutorestore: Work session started. performAutorestore complete.");
						return true;
					}
				}
			}
			
			
			return restoreFromAutosave();

		}

		

		function setupAutosave(settingsobj) {
            

		}

		function performAutosave() {
			if (true || (TmrGlobalStateList == undefined) || (TmrGlobalStateList == null) || (isEmptyObj(TmrGlobalStateList))) {
				console.log('performAutosave: Initializing TmrGlobalStateList')
				TmrGlobalStateList = getTmrState() // init
			}
		
			window.localStorage.setItem("TmrGlobalStateListAuto",JSON.stringify(TmrGlobalStateList))
			window.localStorage.setItem("TmrVersionAuto",TmrVersion)
			console.log("performAutosave: completed.");
		}
		
		
		
 	</script>
 </head>
 
 <body>
 
 	<header>
 		<nav>
 		</nav>
 	</header>
 
 	<h1>Work/Break Tmr</h1>
 
 	<!-- content goes here -->
 	<form action="#" id="frmTmr">
 		<fieldset id="settings">
	  	<legend>Settings</legend>
		  <label for="workDuration">Work Duration:</label>
		  <input type="text" id="workDuration" name="workDuration" pattern="([\d]{2}:[\d]{2}|[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:15:00"> <br/>
		  
		  <label for="breakDuration">Break Duration:</label>
		  <input type="text" id="breakDuration" name="breakDuration" pattern="([\d]{2}:[\d]{2}|[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:05:00"> <br/>
		  
		  <label for="longBreakDuration">Long Break Duration:</label>
		  <input type="text" id="longBreakDuration" name="longBreakDuration" pattern="([\d]{2}:[\d]{2}|[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:20:00"> <br/>
		  
		  <label for="longBreakAfter">Sessions before long break:</label>
		  <input type="text" id="longBreakAfter" name="longBreakAfter" pattern="[\+\-]*[\d]+" title="Use integer value, or disable with negative value" value="3"> <br/>
		  
		  <label for="notifyDuration">Notify Duration:</label>
		  <input type="text" id="notifyDuration" name="notifyDuration" pattern="([\d]{2}:[\d]{2}|[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:01:00"> <br/>
		  
		  <input type="checkbox" id="cbAutoSwitchToWork" name="cbAutoSwitchToWork" value="1" /><label for="cbAutoSwitchToWork" class="checkbox">Switch to working automatically after break ends</label> <br/>
		  <input type="checkbox" id="cbAutoSwitchToBreak" name="cbAutoSwitchToBreak" value="1" /><label for="cbAutoSwitchToBreak" class="checkbox">Switch to break automatically after work session ends</label> <br/>
		  	
		  <input type="checkbox" id="cbEnableLongBreaks" name="cbEnableLongBreaks" value="1" checked /><label for="cbEnableLongBreaks" class="checkbox">Enable long breaks after above specified work session count</label> <br/>
		  	
		  <input type="checkbox" id="cbLongbreaksCountOnlyCompletedWork" name="cbLongbreaksCountOnlyCompletedWork" value="1" /><label for="cbLongbreaksCountOnlyCompletedWork" class="checkbox">Count only full work sessions towards long breaks (count started work session if unchecked)</label> <br/>
		  	
		  <input type="checkbox" id="cbDesktopNotify" name="cbDesktopNotify" value="1" checked /><label for="cbDesktopNotify" class="checkbox">Show Desktop Notifications (if allowed by browser)</label> <br/>
		  	
		  <input type="checkbox" id="cbFocusTmrOnBreak" name="cbFocusTmrOnBreak" value="1" checked /><label for="cbFocusTmrOnBreak" class="checkbox">Focus the timer after clicking on notifications for breaks (to give you more incentive to take them)</label> <br/>	
			
		  <input type="checkbox" id="cbPlayAudio" name="cbPlayAudio" value="1" checked /><label for="cbPlayAudio" class="checkbox">Play Audio Notifications (if allowed by browser)</label> <br/>
		  
		  <input type="checkbox" id="cbAutoRunOnLoad" name="cbAutoRunOnLoad" value="1" /><label for="cbAutoRunOnLoad" class="checkbox">Automatically run on page load with user settings from local storage (save (again) to local storage update setting)</label> <br/>
		  
		  <input type="button" onClick="validateInput()" value="Check">
		  Presets: 
		  <a href="" onClick="document.getElementById('workDuration').value='00:15:00'; document.getElementById('breakDuration').value='00:05:00'; document.getElementById('longBreakDuration').value='00:20:00'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:01:00'; document.getElementById('cbAutoSwitchToWork').checked=false; document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">RSI1</a>
		  <a href="" onClick="document.getElementById('workDuration').value='00:15:00'; document.getElementById('breakDuration').value='00:05:00'; document.getElementById('longBreakDuration').value='00:20:00'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:01:00'; document.getElementById('cbAutoSwitchToWork').checked=true;  document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">RSI2</a>
	          <a href="" onClick="document.getElementById('workDuration').value='00:15:00'; document.getElementById('breakDuration').value='00:05:00'; document.getElementById('longBreakDuration').value='00:20:00'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:01:00'; document.getElementById('cbAutoSwitchToWork').checked=false; document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=false; document.getElementById('cbPlayAudio').checked=false; return false;">RSI3</a>
		  <a href="" onClick="document.getElementById('workDuration').value='00:25:00'; document.getElementById('breakDuration').value='00:05:00'; document.getElementById('longBreakDuration').value='00:15:00'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:01:00'; document.getElementById('cbAutoSwitchToWork').checked=false; document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">Pomodoro 1</a>
		  <a href="" onClick="document.getElementById('workDuration').value='00:25:00'; document.getElementById('breakDuration').value='00:05:00'; document.getElementById('longBreakDuration').value='00:30:00'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:01:00'; document.getElementById('cbAutoSwitchToWork').checked=false; document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">Pomodoro 2</a>
		  <a href="" onClick="document.getElementById('workDuration').value='00:00:12'; document.getElementById('breakDuration').value='00:00:09'; document.getElementById('longBreakDuration').value='00:00:19'; document.getElementById('longBreakAfter').value='3';  document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:00:05'; document.getElementById('cbAutoSwitchToWork').checked=false; document.getElementById('cbAutoSwitchToBreak').checked=false; document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">Debug1</a>
		  <a href="" onClick="document.getElementById('workDuration').value='00:00:12'; document.getElementById('breakDuration').value='00:00:09'; document.getElementById('longBreakDuration').value='00:00:19'; document.getElementById('longBreakAfter').value='3'; document.getElementById('cbEnableLongBreaks').checked=true;  document.getElementById('notifyDuration').value='00:00:05'; document.getElementById('cbAutoSwitchToWork').checked=true;   document.getElementById('cbAutoSwitchToBreak').checked=true;  document.getElementById('cbFocusTmrOnBreak').checked=true;  document.getElementById('cbPlayAudio').checked=true;  return false;">Debug2</a>
	  </fieldset>
	  <br/>

	  
	  <br/>

	  <fieldset id="status">
		  <legend>Status</legend>	  
		  
		  <img src="blank.png" alt="state graphic" style="max-width: 250px; height:150px; float:right;" id="symbolimg">
		  
		  <label for="elapsedDuration">Elapsed Duration:</label>
		  <input type="text" id="elapsedDuration" name="elapsedDuration" pattern="([\+\-]*[\d]{2}:[\d]{2}|[\+\-]*[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:00:00"><br/>
		  <label for="remainDuration">Remaining Duration:</label>
		  <input type="text" id="remainDuration" name="remainDuration" pattern="([\+\-]*[\d]{2}:[\d]{2}|[\+\-]*[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:00:00"><br/>
		  <label for="DateTime">Current Date, Time:</label>
		  <input type="text" id="DateTime" name="DateTime" pattern="[\d]{4}-[\d]{2}-[\d]{2} [\d]{2}:[\d]{2}:[\d]{2}" title="Use time format 'yyyy-mm-dd hh:mm:ss'" value="0000-00-00 00:00:00"><br/>
		  <label for="WrkBrkTime">Next Work/Break at:</label>
		  <input type="text" id="WrkBrkTime" name="WrkBrkTime" pattern="[\d]{4}-[\d]{2}-[\d]{2} [\d]{2}:[\d]{2}:[\d]{2}" title="Use time format 'yyyy-mm-dd hh:mm:ss'" value="0000-00-00 00:00:00"><br/>
		  
		  <fieldset id="rdWB">
			<legend>Currently</legend>
			<input type="radio" id="rbWrkBrk_Wrk" name="rbWrkBrk" value="Work" checked disabled /><label for="rbWrkBrk_Wrk" class="radio" >Working</label> <br/>
			<input type="radio" id="rbWrkBrk_Brk" name="rbWrkBrk" value="Break" disabled /><label for="rbWrkBrk_Brk" class="radio" >On Break</label> 
		  </fieldset>
		  
		  <div style="clear:both; padding:1px 0px;"></div>
		  <label for="edtstatus">Status:</label>
		  <input type="text" id="edtstatus" name="edtstatus" value="" size="55"> <br/>
	  </fieldset>
	  <br/>
	  
	  <fieldset id="actions">
		  <legend>Actions</legend>	  
		  
		  <input type="button" class="btnBig" id="btnWork" onClick="StartWork()" accesskey="w" value="Start/Resume Working">
		  <input type="button" class="btnBig" id="btnBreak" onClick="StartBreak()" accesskey="b" value="Take Break">
		  <div class="medBtnGrp"><input type="button" class="btnMedium" id="btnShortBreak" onClick="StartBreak(breaktype.SHORTBREAK)" accesskey="t" value="Take Short Break">
		  <input type="button" class="btnMedium" id="btnLongBreak"  onClick="StartBreak(breaktype.LONGBREAK)" accesskey="g" value="Take Long Break"></div>
		  <input type="button" class="btnBigNarrow" id="btnPause" onClick="pauseTmr()" accesskey="p" value="Pause Tmr">
		  <input type="button" class="btnBigNarrow" id="btnResume" onClick="startTmr()" accesskey="s" value="Start/Resume Tmr">
	  </fieldset>
	  <br/>
	  
	  <fieldset id="statisticactions">
		  <legend>Statistics</legend>	  
			  <label for="workSum">Total Work Duration:</label>
			  <input type="text" id="workSum" name="workSum" pattern="([\+\-]*[\d]{2}:[\d]{2}|[\+\-]*[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:00:00"> <br/>
			  <label for="breakSum">Total Break Duration:</label>
			  <input type="text" id="breakSum" name="breakSum" pattern="([\+\-]*[\d]{2}:[\d]{2}|[\+\-]*[\d]{2}:[\d]{2}:[\d]{2})" title="Use time formats hh:mm or hh:mm:ss" value="00:00:00"> <br/>
		  
			  <label for="edtstatistics" class="nowidth" style="vertical-align:top;">Statistics:</label>
			  <textarea cols="55" rows="6" id="edtstatistics" name="edtstatistics"></textarea>
			  <!--input type="text" id="edtstatistics" name="edtstatistics" value="" size="94"--> <br/>
			  
			  <label for="nothing1" class="">Reset stats:</label>
			  <input type="button"  id="btnClearSessionCounts" onClick="clearSessionCounts()" value="Clear Session Counters">
			  <input type="button"  id="btnClearSessionTimeSums" onClick="clearSessionTimeSums()" value="Clear Session Time Sums">
			  <input type="button"  id="btnClearSessionTimeSums" onClick="clearSessionCounts(); clearSessionTimeSums();" value="Clear Count and Time Sums">
		  </fieldset>
		  <br/>
		  
		  <fieldset id="localstorageactions">
		  <legend>Local Storage</legend>	  
		   	<input type="button" name="btnSaveLocal" value="Save to local storage" onClick="saveToLocalStorageUser();">
			<input type="button" name="btnLoadLocal" value="Load from local storage" onClick="restoreFromLocalStorageUser();">
			<input type="button" name="btnLoadLocal" value="Load autosave" onClick="restoreFromAutosave();">
			<input type="button" name="btnClearLocalUser" value="Clear data (user)" onClick="clearLocalStorageUser();">
			<input type="button" name="btnClearLocalAuto" value="Clear data (autosave)" onClick="clearAutosave();">
			<input type="button" name="btnClearLocalAll" value="Clear data (everything)" onClick="clearLocalStorageAll();"><br/>
	  </fieldset>
		  
	  <br/><br/>
	  <input type="reset">
	  <input type="submit">
	  <input type="button"  id="btnClrLog" onClick="clearLog();" value="Clear Log">
	  <input type="checkbox" id="cbDebugLog" name="cbDebugLog" value="1" /><label for="cbDebugLog" class="checkbox">Verbose (debug) log</label> <br/>
	  <br/>
	  <label for="tlog" class="tlog">Log:</label> <br/>  
	  <textarea cols="55" rows="10" id="tlog"></textarea>
	  <!--img src="blank.png" alt="state graphic" style="max-width: 250px; height:150px;" id="symbolimg"-->
	</form>
 	
 	<audio id="audio_breakover">
	  <source src="breakover.mp3" type="audio/mpeg">
	  <source src="breakover.wav" type="audio/wave">
	  Your browser does not support the audio element.
	</audio>
	
	<audio id="audio_breakrequired">
	  <source src="breakrequired.mp3" type="audio/mpeg">
	  <source src="breakrequired.wav" type="audio/wave">
	  Your browser does not support the audio element.
	</audio>
	
	<audio id="audio_longbreakover">
	  <source src="longbreakover.mp3" type="audio/mpeg">
	  <source src="longbreakover.wav" type="audio/wave">
	  Your browser does not support the audio element.
	</audio>
	
	<audio id="audio_longbreakrequired">
	  <source src="longbreakrequired.mp3" type="audio/mpeg">
	  <source src="longbreakrequired.wav" type="audio/wave">
	  Your browser does not support the audio element.
	</audio>
 		
 		
 		
 	<footer>
 		<form id="sums" action="#">
 		  
		  
		  
		  <a href="licenses.htm">Licenses and Acknowledgments</a>
 		</form>
 	</footer>
	
	<script type="text/javascript">
		performAutorestore();
	</script>
 
 </body>
 
 </html>
